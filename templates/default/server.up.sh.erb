#!/bin/sh
#
# Script to run during OpenVPN startup
# Auto generated by Chef, local changes will be overwritten

# Enable IP forwarding
/sbin/sysctl -w net.ipv4.ip_forward=1

# Enable iptables NAT rules
/sbin/iptables -t nat -A POSTROUTING -s <%= node['openvpn2']['subnet'] %>/<%= node['openvpn2']['netmask'] %> -o <%= node['network']['default_interface'] %> -j MASQUERADE

# Exec scripts under /etc/openvpn/server.up.d
for file in $(/bin/ls /etc/openvpn/server.up.d/*.sh 2>/dev/null || echo); do
  . ${file}
done
